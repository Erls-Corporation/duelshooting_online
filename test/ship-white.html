<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Duel Shooting</title>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">google.load('prototype', '1.7')</script>


<script type="text/javascript" src="/js/action/base/action.js"></script>
<script type="text/javascript" src="/js/action/action-ship-red.js"></script>
<script type="text/javascript" src="/js/action/action-ship-white.js"></script>

<script type="text/javascript" src="/js/command/base/command.js"></script>
<script type="text/javascript" src="/js/command/command-ship-red.js"></script>
<script type="text/javascript" src="/js/command/command-ship-white.js"></script>

<script type="text/javascript" src="/js/game/game.js"></script>
<script type="text/javascript" src="/js/sound/sound-creater.js"></script>
<script type="text/javascript" src="/js/auto/automatic-controls.js"></script>
<script type="text/javascript" src="/js/sync/synchronizer.js"></script>

<script type="text/javascript" src="/js/sprite/base/sprite.js"></script>
<script type="text/javascript" src="/js/sprite/background.js"></script>
<script type="text/javascript" src="/js/sprite/bullet.js"></script>
<script type="text/javascript" src="/js/sprite/bullet-linear.js"></script>
<script type="text/javascript" src="/js/sprite/bullet-homing.js"></script>
<script type="text/javascript" src="/js/sprite/funnel.js"></script>
<script type="text/javascript" src="/js/sprite/funnel-circle.js"></script>
<script type="text/javascript" src="/js/sprite/funnel-defence-left.js"></script>
<script type="text/javascript" src="/js/sprite/funnel-defence-right.js"></script>
<script type="text/javascript" src="/js/sprite/funnel-slider.js"></script>
<script type="text/javascript" src="/js/sprite/i-field.js"></script>

<script type="text/javascript" src="/js/sprite/ship.js"></script>
<script type="text/javascript" src="/js/sprite/ship-white.js"></script>
<script type="text/javascript" src="/js/sprite/ship-red.js"></script>
<script type="text/javascript" src="/js/sprite/ship-afterimage.js"></script>


<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
Event.observe(window, 'load', function () {

    var sound = new SoundCreater();
    var hitSE = sound.createAudio('/se/hit.mp3');
    var loseSE = sound.createAudio('/se/lose.mp3');
    var newtypeSE = sound.createAudio('/se/newtype.mp3');
    var attackSE = sound.createAudio('/se/attack.mp3')
    var megaCannonSE = sound.createAudio('/se/mega.mp3')
    var funnelGoSE = sound.createAudio('/se/funnel1.mp3')
    var funnelAtkSE = sound.createAudio('/se/funnel2.mp3')

    var white = new ShipWhite(false);
    white.setSoundHit(hitSE);
    white.setSoundLose(loseSE);

    var red = new ShipRed(true);
    red.setSoundHit(hitSE);
    red.setSoundLose(loseSE);
    red.setSoundNewtype(newtypeSE);

    var bg = new Background();

    var shipWeapons = new AutomaticControls(white, red);
    shipWeapons.setSoundAttack(attackSE);
    shipWeapons.setSoundMegaCannon(megaCannonSE);
    shipWeapons.setSoundFunnelGo(funnelGoSE);
    shipWeapons.setSoundFunnelAttack(funnelAtkSE);

    var enemyWeapons = new AutomaticControls(red, white);
    enemyWeapons.addIField(false);
    enemyWeapons.addFunnelDefences(false);

    var action = new ActionShipWhite();
    var shipCmd = new CommandShipWhite(white, shipWeapons);
    var enemyCmd = new CommandShipRed(red, enemyWeapons);

    var sync = new Synchronizer('http://localhost:3000/');
    sync.listenShipWhiteCommand(shipCmd, white);
    sync.listenShipRedCommand(enemyCmd, red);

    var game = new Game(function() {
        sync.pushShipWhiteCommand(action.getCommand(), white.getHitPoint());
        shipWeapons.move();
        enemyWeapons.move();
    });
    
    bg.renderElement();
    white.renderElement();
    red.renderElement();

    game.start();
});
</script>
</head>
<body>
</body>
</html>
